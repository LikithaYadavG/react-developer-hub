import { render, screen } from "@testing-library/react";
import userEvent from "@testing-library/user-event";
import { describe, it } from "vitest";
import { EmptyState, type EmptyStateProps } from "./EmptyState";

const defaultProps: EmptyStateProps= {
	title: "No results found",
};

const renderEmptyState = (additionalProps?: Partial<EmptyStateProps>) => {
	return render(<EmptyState {...defaultProps} {...additionalProps} />);
};

describe("EmptyState", () => {
	it("should render the title", () => {
		renderEmptyState();

		expect(
			screen.getByRole("heading", { name: /no results found/i }),
		).toBeInTheDocument();
	});

	it("should render description when provided", () => {
		renderEmptyState({
			description: "Try adjusting your filters",
		});

		expect(screen.getByText(/try adjusting your filters/i)).toBeInTheDocument();
	});

	it("should not render description when not provided", () => {
		renderEmptyState();

		expect(screen.queryByText(/try adjusting/i)).not.toBeInTheDocument();
	});

	it("should render a section with accessible name", () => {
		renderEmptyState();

		expect(
			screen.getByRole("region", { name: /no results found/i }),
		).toBeInTheDocument();
	});

	it("should render default icon when no custom icon is provided", () => {
		renderEmptyState();

		expect(screen.getByLabelText(/no results found/i)).toBeInTheDocument();
	});

	it("should render custom icon when icon prop is provided", () => {
		renderEmptyState({
			icon: <span>Custom Icon</span>,
		});

		expect(screen.getByText(/custom icon/i)).toBeInTheDocument();
	});

	it("should render action when provided", () => {
		renderEmptyState({
			action: <button type="button">Create item</button>,
		});

		expect(
			screen.getByRole("button", { name: /create item/i }),
		).toBeInTheDocument();
	});

	it("should allow interaction with action element", async () => {
		const user = userEvent.setup();

		renderEmptyState({
			action: <button type="button">Retry</button>,
		});

		await user.click(screen.getByRole("button", { name: /retry/i }));

		expect(screen.getByRole("button", { name: /retry/i })).toBeInTheDocument();
	});

	it("should support search variant", () => {
		renderEmptyState({
			variant: "search",
		});

		expect(
			screen.getByRole("heading", { name: /no results found/i }),
		).toBeInTheDocument();
	});

	it("should support noData variant", () => {
		renderEmptyState({
			variant: "noData",
		});

		expect(
			screen.getByRole("heading", { name: /no results found/i }),
		).toBeInTheDocument();
	});

	it("should support folder variant", () => {
		renderEmptyState({ variant: "folder" });

		expect(
			screen.getByRole("heading", { name: /no results found/i }),
		).toBeInTheDocument();
	});
});
